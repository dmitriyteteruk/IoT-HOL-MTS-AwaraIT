### 01.3. Добавление IoT Edge устройства в Azure IoT Hub
1. В меню слева кликните на кнопке IoT Edge, чтобы перейти в раздел по добавлению устройств IoT Edge
![image](https://user-images.githubusercontent.com/34028526/154064721-024f7a0b-2065-4d99-99cf-8cf9101c5e0f.png)

---

2. На странице IoT Edge устройство кликните **+ Добавить устройство IoT Edge**
![image](https://user-images.githubusercontent.com/34028526/154065035-41cff9ff-557c-411d-8453-07f2c304cdb5.png)

---

3. В меню добавления устройства укажите **ИД устройства** (идентификатор устройства). Проверьте, что _Тип проверки подлинности_ выбран **Симметричный ключ**, _Автоматическое формирование ключей_ **Отмечено**, _Подключение устройства к Центру Интернета вещей_ **Включено**. Затем нажмите **Сохранить**.

![image](https://user-images.githubusercontent.com/34028526/154065388-5f4ba80b-8134-4919-bb46-20d7f982b98a.png)

---

4. На странице устройств нажмите на **ИД утройства** (my-iotedge-device).

![image](https://user-images.githubusercontent.com/34028526/154066206-346742be-5b06-4cf0-a4b5-93cefe5a1e4d.png)

----

5. На странице устройства найдите **Первичную строку подключения** и скопируйте значение, например, в текстовый файл приложения Блокнот, т.к. строка подключения потребуется нам в дальнейшем. 

![image](https://user-images.githubusercontent.com/34028526/154066618-08a68c37-b22f-4b9b-bd17-42b8f935c998.png) 

Мы добавили в реестр устройств Центра IoT новое Azure IoT Edge устройтво. После первого подключения устройство загрузит 2 системных модуля **$edgeAgent** и **$edgeHub**. Они уже сейчас указаны  в закладке **Модули**. Наш следующий шаг - указать информацию о приложении, которое мы хотим удаленно развернуть на множестве устройств.

---

6.  Добавление информации для удаленного развертвания IoT Edge модуля (docker контейнера) в Центре IoT. В верхнем меню кликните кнопку **Задать модули**.
![image](https://user-images.githubusercontent.com/34028526/155115677-43021e4a-1548-40e5-a8fd-1c0b75e2d806.png)
 
---

7. На странице настройки модулей выберите пункт меню **+Добавить**, в открывшемся меню выберите пункт **+Модуль IoT Edge**.

![image](https://user-images.githubusercontent.com/34028526/155116566-fe8c6b73-ef19-4fde-8c19-ae5a97e8c4e5.png)

---

8. В открывшемся окне необходимо указать информацию о том, откуда модуль будет скачиваться, и куда отправлять информацию. На вкладке **Параметры модуля** укажите следующую информацию: 

| Параметр  | Значение |
| ------------- | ------------- |
| Имя модуля IoT Edge  | MTS  |
| URI образа  | docker-private-registry-at-mts.azuremsk.cloudapp.ec.mts.ru:5000/mts:1.0  |
| Политика перезапуска  | всегда  |
| Нужное состояние  | выполняется  |
| Политика извлечения образов  | пусто  |
| Порядок запуска  | 200  |

![image](https://user-images.githubusercontent.com/34028526/155118865-a3bd8e41-e5f3-4277-b77e-0e92b93b4010.png)

----

9. Перейдите на вкладку **Переменные среды**, здесь мы укажем нашему приложения откуда брать данные и куда их отправлять. Внесите нижеследующие параметры и нажмите кнопку **Добавить**.

| Имя  | Тип | Значение |
| ------------- | ------------- | ------------- |
| GENERATOR_URL | Текст | http://52.236.29.114/8080/  |
| ENDPOINT_URL  | Текст | https://iotspace.mts.ru/api/v1/integrations/http/2a3102da-064c-0c7c-5196-3d9b605f5829  |
| MSG_INTERVAL_MS  | Число | 10000  |
| DEVICE  | Текст | energy:23154,water:12473d  |
| HEADER  | Текст | asdasd  |
| SECRET  | Текст | afasfasfasfas  |

![image](https://user-images.githubusercontent.com/34028526/155122081-7fd763dc-0223-4a72-954f-98d646cccc57.png)

---

10. Теперь на странице **Настройки модулей** мы можем видеть информацию о модуле **MTS**, нажмите кнопку **Просмотр и создание**

![image](https://user-images.githubusercontent.com/34028526/155122362-d72e4ff4-c0fc-4431-b939-a7ac3fc60c2e.png)

---

11. На вкладке **Просмотр и создание** убедитесь, что сообщение **Проверка пройдена** присутствует. В текстовом поле отображается манифест развертывания, где указаны все параметры для нашего приложения. Для создания развертывания нажмите кнопку **Создать**.

![image](https://user-images.githubusercontent.com/34028526/155122925-6dea0ac1-eea5-4ae5-a958-6d33ae37498c.png)

---

12. Теперь на странице управления нашим IoT Edge устройством видно, что помимо двух системных модулей устройство будет запускать модуль MTS. В настоящий момент Состояние среды выполнение показывает статус **Ошибка**, это нормально, т.к. мы всего лишь добавили в нашем Центре IoT информацию об устройстве и приложениях, но само устройство мы еще не запускали.

![image](https://user-images.githubusercontent.com/34028526/155123254-9d7efa6c-afb0-4b3a-b37e-81c4d665f1a6.png)

---

Следующий этап **Создание виртуальной машины (шлюза) Ubuntu 18.04**
